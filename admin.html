<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Admin Page</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/shop-item.css" rel="stylesheet">

    <link href="css/admin.css" rel="stylesheet">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

</head>

<body>

    <!-- Navigation -->
    <div id="header"></div>
    <!-- Page Content -->
    <div class="container">

        <div class="row">

            <div class="col-lg-3">
                <h2 id="rTitle" class="my-4">Existing Users <label class="labelUserType"> - Admin</label></h2>
                <div class="list-group">
                    <a href="#nuser" name="navNuser" class="list-group-item">Normal User</a>
                    <a href="#opera" name="navOpera" class="list-group-item">Operator</a>
                    <a href="#admin" name="navAdmin" class="list-group-item">Administrator </a>
                </div>
            </div>
            <!-- /.col-lg-3 -->

            <div class="col-lg-9">
                <div id="nuser" class="views">
                    <div class="card card-outline-secondary my-4">
                        <div class="card-header" ondragover="allowDrop(event)" ondrop="drop(event)">
                            Normal User
                            <img src="image/addUser24px.png" id="nuserAddbtn" class="addUserbtn" />
                        </div>
                        <div class="card-body" ondragover="allowDrop(event)" ondrop="drop(event)">
                            <div class='form-label-group'></div>
                        </div>
                    </div>
                </div>
                <br />
                <div id="opera" class="views">
                    <div class="card card-outline-secondary my-4">
                        <div class="card-header" ondragover="allowDrop(event)" ondrop="drop(event)">
                            Operator
                            <img src="image/addUser24px.png" id="operaAddbtn" class="addUserbtn" />
                        </div>
                        <div class="card-body" ondragover="allowDrop(event)" ondrop="drop(event)">
                            <div class='form-label-group'></div>
                        </div>
                    </div>
                </div>
                <br />
                <div id="admin" class="views">
                    <div class="card card-outline-secondary my-4">
                        <div class="card-header" ondragover="allowDrop(event)" ondrop="drop(event)">
                            Administrator
                            <img src="image/addUser24px.png" id="adminAddbtn" class="addUserbtn" />
                        </div>
                        <div class="card-body" ondragover="allowDrop(event)" ondrop="drop(event)">
                            <div class='form-label-group'></div>
                        </div>

                    </div>
                </div>
                <div id="action" style="position: fixed;bottom:2em;right:2em;">
                    <div id="btn-reset" class="btn btn-danger">Reset</div>
                    <div id="btn-save" class="btn btn-primary">Save</div>
                </div>
            </div>
        </div>

    </div>
    <!-- /.container -->

    <!-- Footer -->
    <div id="footer"></div>

    <!-- Bootstrap core JavaScript -->
    <script src="jquery/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/render.js"></script>
    <script>
        $(document).ready(function () {
            $("#header").load("components/nav.html");
            $("#footer").load("components/footer.html");

            var divs = document.getElementsByClassName("form-label-group");
            for (var i = 0; i < divs.length; i++) {
                divs[i].setAttribute("ondrop", "drop(event)");
                divs[i].setAttribute("ondragover", "allowDrop(event)");
            }

            const existingUsers = {
                user: [],
                operator: [],
                admin: []
            };
            const createRow = (user) => {
                const row = $("<pre id='" + user.username + "'class='data' draggable='true' ondragstart='drag(event)'>");
                const alias = " <label class='inputlbl'>" + user.alias + "</label>";
                const action = "<img src='image/del24px.png' class='databtn' /><img src='image/edit24px.png' class='databtn' />"
                row.html(user.username + "\t" + user.password + "\t" + alias + action);
                $(row.find("img")[0]).click(function(){$(this).parent().fadeOut()})
                return row;
            }
            $.getJSON("data/user.json", (data) => {
                existingUsers.user = data.filter((v) => {
                    return (v.type == "user")
                })
                existingUsers.operator = data.filter((v) => {
                    return (v.type == "operator")
                })
                existingUsers.admin = data.filter((v) => {
                    return (v.type == "admin")
                })

                existingUsers.user.forEach(v => {
                    $($(".card")[0]).find(".form-label-group").append(createRow(v))
                })

                existingUsers.operator.forEach(v => {
                    $($(".card")[1]).find(".form-label-group").append(createRow(v))
                })

                existingUsers.admin.forEach(v => {
                    $($(".card")[2]).find(".form-label-group").append(createRow(v))
                })
            })
            $("#btn-reset").click(() => {
                $.getJSON("data/user.json", (data) => {
                    $(".card").find(".form-label-group").html("");
                    existingUsers.user = data.filter((v) => {
                        return (v.type == "user")
                    })
                    existingUsers.operator = data.filter((v) => {
                        return (v.type == "operator")
                    })
                    existingUsers.admin = data.filter((v) => {
                        return (v.type == "admin")
                    })
                    existingUsers.user.forEach(v => {
                        $($(".card")[0]).find(".form-label-group").append(createRow(v))
                    })

                    existingUsers.operator.forEach(v => {
                        $($(".card")[1]).find(".form-label-group").append(createRow(v))
                    })

                    existingUsers.admin.forEach(v => {
                        $($(".card")[2]).find(".form-label-group").append(createRow(v))
                    })
                })
            })
        })

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("pre", ev.target.id);
        }

        function drop(ev) {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("pre");
            if ($(ev.target).hasClass("data")) {
                ev.target.parentElement.appendChild(document.getElementById(data));
            }
            else if ($(ev.target).hasClass("card-body") || $(ev.target).hasClass("card-header")) {
                $(ev.target).parent().find(".form-label-group").append(document.getElementById(data))
            }
            else {
                ev.target.appendChild(document.getElementById(data));
            }
        }
    </script>
</body>

</html>